# Сервис динамического сегментирования пользователей

## Задача:

Требуется реализовать сервис, хранящий пользователя и сегменты, в которых он состоит (создание, изменение, удаление сегментов, а также добавление и удаление пользователей в сегмент)

## Описание

Реализовал REST API сервис, для хранения пользователей и сегментов, в которых они состоят. 
Методы, которые поддерживает сервис:


- **POST** /segments - метод создания сегмента. В теле запроса передается json следующего формата: {"segment":<"name">,"auto_percent":<0>}. segment - имя сегмента для создания, auto_percent - опциональный процент пользователей для автоматического добавления (по умолчанию 0). Вовзращает имя сегмента при успешном добавлении, ошибку при неуспешном.


- **DELETE** /segments - метод удаления сегмента. В теле запроса передается json следующего формата: {"segment":<"name">}. segment - имя сегмента для удаления.


- **POST** /users - метод создания пользователя. Следующий формат: {"id":<0>}. id - кастомный id пользователя, может быть только > 0. Вовзращаяет id при успешной добавлении, ошибку иначе.


- **PATCH** /users - метод добавления пользователю сегментов. Добавлять сегменты можно только существующему пользователю. Добавление несуществующих сегментов также повлечет ошибку. Формат следующий {"id":<0>,"segments":<["a","b","c"]>,"active_time":<0>}. "segments" - массив названий сегментов, active_time - на сколько добавляем данные сегменты пользователю в секундах (второе доп задание). active_time - опциональный параметр, без пару user-segment можно будет удалить только вручную. Возвращает успешно добавленные сегменты или ошибку.


- **DELETE** /users - метод удаления сегментов у пользователя. Удалять можно только у существующего пользователя. Формат {"id":<0>,"segments":<["a","b"]>}.


- **GET** /users/:id - метод получения всех активных сегментов пользователя. Возвращает {"id":<0>,"segments":<["a","b"]>} в успешном случае, ошибку в ином.


- **GET** /users/:id/history?year=<2023>&month=<8> - метод получения истории конкретного пользователя по его id. В Query получает год и месяц для получения истории. Возвращает csv файл с данной историей.


(все что в <> - примеры)


## Запуск 

Чтобы собрать на локальной машине введите: make build

Чтобы запустить на локальной машине: make run

Чтобы запустить все тесты: make test



Чтобы собрать на docker: docker-compose up --build server 

Необходимо также описать все необходимые переменные (DATABASE_DSN - строка подключения к базе данных без пароля(пример: host=db user=postgres dbname=postgres sslmode=disable), DATABASE_PASSWORD - пароль к базе данных, SERVER_HOST - хост, на котором будет запускаться сервер (по умолчанию ":8080"), LOG_FILE_PATH - путь до лог файл (по умолчанию консоль))

 
## Уточнения

1. Мне показалось гораздо более гибким возвращать не ссылку на файл, а сам файл, поэтому я так и сделал




